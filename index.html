<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIC AI ‚Äî CRION</title>
<style>
  :root{
    --bg:#0f6fa3;          /* azul do painel */
    --card:#ffffff;        /* cards */
    --ink:#11223a;
    --muted:#5f6b7a;
    --line:#e9eef7;
    --pill-sites:#1541ff;  /* azul tag SITES */
    --pill-alert:#ff2a2a;  /* vermelho tag ALERTAS */
    --pill-proc:#ff7a2a;   /* laranja tag PROCEDIMENTOS */
    --btn:#24b38a;         /* verde do bot√£o */
    --btn-ink:#053b2e;
    --shadow:0 24px 50px rgba(5,35,70,.28);
    --card-shadow:0 16px 36px rgba(15,111,163,.22);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font:15px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; color:var(--ink);
    background:radial-gradient(1100px 520px at -8% -10%, #1d8fd0 0, var(--bg) 55%);
  }
  .wrap{max-width:1180px;margin:20px auto;padding:22px;border-radius:26px;background:linear-gradient(180deg,#1884bf,#1577b0);
        box-shadow:var(--shadow)}
  /* header */
  .hero{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#188bc8,#1577b0);
        border-radius:18px;padding:12px 16px;color:#fff}
  .logoL{height:46px;object-fit:contain;filter:drop-shadow(0 2px 6px #0002)}
  .tools{display:flex;gap:10px;align-items:center}
  .tool{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;color:#0b2b46;
        background:#ffd85b;box-shadow:0 10px 24px rgba(0,0,0,.18)}
  .tool.calc{background:#98b7ff}
  .brandR{height:40px;object-fit:contain;filter:drop-shadow(0 2px 6px #0002)}

  /* grid 2x2 */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--card-shadow)}
  .tag{display:inline-block;color:#fff;font-weight:900;border-radius:12px;padding:6px 14px;letter-spacing:.3px}
  .tag.alert{background:var(--pill-alert)}
  .tag.sites{background:var(--pill-sites)}
  .tag.proc{background:var(--pill-proc)}
  h2{margin:10px 0 10px;font-size:20px}

  .row{display:flex;gap:10px;align-items:center}
  .input{flex:1;border:1px solid var(--line);border-radius:12px;background:#fbfdff;padding:12px}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer;
       background:var(--btn);color:var(--btn-ink);box-shadow:0 12px 26px rgba(36,179,138,.3)}
  .btn:active{transform:translateY(1px)}

  .out{min-height:118px;border:1px dashed var(--line);border-radius:12px;background:#f6f9ff;padding:12px;margin-top:10px;white-space:pre-wrap}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}

  /* RR.png box (grande, com sombra) */
  .rrbox{display:grid;place-items:center;background:#ffffff;border:1px solid var(--line);border-radius:16px;padding:10px;
         box-shadow:var(--card-shadow)}
  .rr{width:100%;max-width:540px;height:auto;display:block;filter:drop-shadow(0 20px 40px rgba(99,102,241,.25))}

  footer{margin-top:18px;text-align:center;color:#e6f4ff;font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <header class="hero">
      <img class="logoL" src="icon2.png"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/icon2.png';" alt="CRION">
      <div class="tools">
        <div class="tool">üìù</div>
        <div class="tool calc">üßÆ</div>
      </div>
      <img class="brandR" src="HDS.png"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/HDS.png';" alt="HDSTEC">
    </header>

    <!-- GRID 2x2 (sem o card de PDFs; RR.png no lugar) -->
    <div class="grid">
      <!-- ALERTAS (esquerda em cima) -->
      <section class="card">
        <span class="tag alert">ALERTAS</span>
        <h2>Controle de alerta</h2>
        <div class="row"><button id="btnAlert" class="btn">PESQUISAR</button></div>
        <div class="out" id="alertBox" style="display:none">
          <div id="alertMsg" style="font-size:22px;font-weight:900;color:#b91c1c">‚Äî</div>
          <div id="alertResp" class="hint">‚Äî</div>
        </div>
        <div class="hint" id="alertBusy" style="display:none">
          Carregando alerta‚Ä¶
        </div>
      </section>

      <!-- SITES (direita em cima) -->
      <section class="card">
        <span class="tag sites">SITES</span>
        <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
        <div class="row" style="margin-top:6px">
          <input id="qSites" class="input" placeholder="Digite sua pergunta .....">
          <button id="btnSites" class="btn">PESQUISAR</button>
        </div>
        <div class="out" id="outSites">_</div>
      </section>

      <!-- RR.png (esquerda em baixo) -->
      <section class="rrbox">
        <img class="rr" src="rr.png"
             onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/rr.png';"
             alt="Ol√°, meu nome √© RIC. Precisa de uma ajuda?">
      </section>

      <!-- PROCEDIMENTOS (direita em baixo) -->
      <section class="card">
        <span class="tag proc">PROCEDIMENTOS</span>
        <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
        <div class="row" style="margin-top:6px">
          <input id="qCRION" class="input" placeholder="Digite sua pergunta .....">
          <button id="btnCRION" class="btn">PESQUISAR</button>
        </div>
        <div class="out" id="crionOut">_</div>
        <div class="hint" id="crionBusy" style="display:none">Listando procedimentos‚Ä¶</div>
      </section>
    </div>

    <footer>¬© 2025 Copyright: HDSTEC. Todos os Direitos Reservados v3.0.0 - Operacao</footer>
  </div>

<script>
/* ===== Config ===== */
const APP_URL = "https://script.google.com/macros/s/AKfycbxnTEhSw1u5Ib0jCqJsURoZM30VfCpfeqKqKvYpXdKgJDUPrw8Q8hScbSzw4zVkI7u0rw/exec";

/* ===== Helpers ===== */
const $ = s => document.querySelector(s);
const show = (el, on=true)=>{ if(!el) return; el.style.display = on? '' : 'none'; };
function esc(s){ return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

/* POST text/plain (sem preflight) */
function call(endpoint, payload){
  const url = APP_URL + "?fn=" + encodeURIComponent(endpoint);
  return fetch(url, {
    method:"POST",
    headers:{ "Content-Type":"text/plain" },
    body: JSON.stringify(payload||{})
  }).then(r=>{ if(!r.ok) throw new Error("HTTP "+r.status); return r.json(); });
}

/* ===== ALERTA ===== */
$('#btnAlert').addEventListener('click', async ()=>{
  show($('#alertBusy'),true); show($('#alertBox'),false);
  try{
    const r = await call('getalert',{});
    const msg=$('#alertMsg'), resp=$('#alertResp');
    if(r && r.ok && r.found){
      msg.textContent = "üö® " + String(r.mensagem||"").toUpperCase();
      resp.textContent = r.responsavel ? String(r.responsavel).toLowerCase() : "";
    }else{
      msg.textContent = "Sem recado no momento.";
      resp.textContent = "";
    }
    show($('#alertBox'),true);
  }catch(e){
    $('#alertMsg').textContent="Erro: "+(e.message||e);
    $('#alertResp').textContent="";
    show($('#alertBox'),true);
  }finally{ show($('#alertBusy'),false); }
});

/* ===== SITES ===== */
$('#btnSites').addEventListener('click', doSites);
$('#qSites').addEventListener('keydown', e=>{ if(e.key==='Enter') doSites(); });
async function doSites(){
  const q=($('#qSites').value||'').trim();
  if(!q){ $('#outSites').textContent='Digite a pergunta.'; return; }
  $('#outSites').textContent='Pesquisando...';
  try{
    const qRich = q + " ‚Äî FORMATO: responda em portugu√™s e liste as URLs oficiais no final.";
    const r = await call('chat',{q:qRich, ua:navigator.userAgent||''});
    const txt = (r && r.text) ? r.text : '‚Äî';
    const html = String(txt).replace(/(https?:\/\/[^\s]+)/g, m=>`<a href="${m}" target="_blank" rel="noopener">${m}</a>`);
    $('#outSites').innerHTML = html;
  }catch(e){ $('#outSites').textContent='Erro: '+(e.message||e); }
}

/* ===== PROCEDIMENTOS (CRION) ===== */
$('#btnCRION').addEventListener('click', doCRION);
$('#qCRION').addEventListener('keydown', e=>{ if(e.key==='Enter') doCRION(); });
async function doCRION(){
  const q=($('#qCRION').value||'').trim();
  if(!q){ $('#crionOut').textContent='Digite um termo.'; return; }
  $('#crionOut').textContent='Listando‚Ä¶'; show($('#crionBusy'),true);
  try{
    const res = await call('searchcrion',{q});
    if(!res || res.ok===false){ $('#crionOut').textContent='Erro ao buscar: '+(res&&res.message?res.message:''); return; }
    const items = res.items || [];
    if(!items.length){ $('#crionOut').textContent='Nenhum resultado.'; return; }

    // Lista simples com meta, e em seguida busca pr√©vias por lote
    const frag = document.createElement('div');
    frag.innerHTML = items.map((it,idx)=>(
      `<div style="padding:10px 0;border-top:1px solid var(--line)">
         <div><b>${esc(it.name||'')}</b> ‚Ä¢ <a href="${it.url}" target="_blank" rel="noopener">Abrir</a></div>
         <div class="hint">Tamanho: ${it.size? (it.size/1024/1024).toFixed(2)+' MB':'‚Äî'} ‚Ä¢ Atualizado: ${it.updated? new Date(it.updated).toLocaleString():'‚Äî'}</div>
         <div class="hint" id="snip_${idx}">Carregando pr√©vias‚Ä¶</div>
       </div>`
    )).join("");
    $('#crionOut').innerHTML = ''; $('#crionOut').appendChild(frag);

    // Snippets
    let from=0;
    while(from < items.length){
      const r = await call('fetchcrionsnippets',{sessionId:res.sessionId, from, limit:6});
      (r.items||[]).forEach(row=>{
        const el = document.getElementById('snip_'+row.index);
        if(!el) return;
        el.innerHTML = (row.snippets && row.snippets.length)
          ? row.snippets.map(s=>`<div style="color:#374151;margin:6px 0">${esc(s)}</div>`).join("")
          : '<span class="hint">‚Äî</span>';
      });
      from = r.to;
    }
  }catch(e){ $('#crionOut').textContent='Erro: '+(e.message||e);
  }finally{ show($('#crionBusy'),false); }
}
</script>
</body>
</html>>

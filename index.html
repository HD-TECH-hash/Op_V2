<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RIC AI â€” CRION</title>
<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --line:#e7eef7;
    --lime:#22c55e; --lime2:#7dd36b; --danger:#ef4444;
    --tag:#f2e7ff; --tag-ink:#6d28d9;
    --bg1:#0e5f9a; --bg2:#1570a5;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font:14px/1.55 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    color:var(--ink);
    background:linear-gradient(180deg,#0f6aa7 0%, #0d5790 100%);
    min-height:100vh;
  }
  .wrap{max-width:1260px;margin:0 auto;padding:18px 18px 28px}

  /* Header minimal (sem barra preenchida) */
  .header{
    display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px;
    margin-bottom:12px;
  }
  .logo{height:44px}
  .tools{justify-self:center; display:flex; gap:14px}
  .fab{
    width:48px; height:48px; border-radius:14px;
    background:rgba(255,255,255,.16); border:1px solid rgba(255,255,255,.35);
    display:grid; place-items:center; backdrop-filter:blur(6px); cursor:pointer; transition:.15s;
  }
  .fab:hover{transform:translateY(-1px); background:rgba(255,255,255,.22)}
  .fab svg{width:24px;height:24px}

  /* Grid principal (2 colunas) */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  /* Cards */
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px}
  .tag{display:inline-flex;align-items:center;gap:8px;background:var(--tag);color:var(--tag-ink);
       border:1px solid #eadbff;border-radius:999px;padding:6px 12px;font-weight:800;font-size:12px}
  h2{margin:8px 0 10px;font-size:18px}
  .row{display:flex;gap:10px;align-items:center}
  .input{width:100%;border:1px solid var(--line);border-radius:10px;padding:10px 12px;background:#fbfcff}
  .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
  .btn-search{color:#053;background:linear-gradient(135deg,var(--lime),var(--lime2)); box-shadow:0 10px 22px rgba(34,197,94,.28)}
  .btn-plain{background:#f7f7fb;color:#111;border:1px solid var(--line)}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .out{white-space:pre-wrap;min-height:120px;border:1px dashed var(--line);border-radius:10px;padding:10px;margin-top:10px;background:#fbfbff}

  /* Mascote (rr.png) sem card, centralizado no painel esquerdo */
  .mascotWrap{position:relative; min-height:380px}
  .mascot{
    position:absolute; left:50%; transform:translateX(-50%);
    width:min(520px, 92%); max-width:560px;
    filter: drop-shadow(0 28px 60px rgba(35,0,120,.20));
    pointer-events:none; user-select:none;
  }

  footer{margin:18px 0 8px;text-align:center;color:#c9e6ff}
  .footnote{font-size:12px;opacity:.9}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER sem barra azul -->
    <div class="header">
      <img class="logo" src="CRION.png" alt="CRION"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ric-crion/main/CRION.png';">
      <div class="tools">
        <!-- Post-it (SVG nÃ­tido) -->
        <button id="toggleNote" class="fab" title="Post-it">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M8 3h8a3 3 0 0 1 3 3v7l-7 7H8a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3Z" stroke="#fff" stroke-width="2"/>
            <path d="M19 13h-4a3 3 0 0 0-3 3v4" stroke="#fff" stroke-width="2"/>
          </svg>
        </button>
        <!-- Calculadora (SVG nÃ­tido) -->
        <button id="toggleCalc" class="fab" title="Calculadora">
          <svg viewBox="0 0 24 24" fill="none">
            <rect x="4" y="3" width="16" height="18" rx="2" stroke="#fff" stroke-width="2"/>
            <rect x="7" y="6" width="10" height="3" rx="1" fill="#fff"/>
            <path d="M8 12h2M8 16h2M12 12h2M12 16h2M16 12h2M16 16h2" stroke="#fff" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <img class="logo" src="HDS.png" alt="HDSTEC"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ric-crion/main/HDS.png';">
    </div>

    <!-- GRID: esquerda (alerta + rr.png), direita (sites + procedimentos) -->
    <div class="grid">
      <div>
        <!-- ALERTA -->
        <section class="card">
          <div class="tag">ALERTA</div>
          <h2>Controle de alerta</h2>
          <div class="row"><button id="btnAlert" class="btn btn-search">Pesquisar</button></div>
          <div class="hint" id="alertBusy" style="display:none">Pesquisandoâ€¦</div>
          <div id="alertMsg"  style="display:none;font-size:22px;font-weight:900;color:#b91c1c;text-align:center;margin-top:8px">â€”</div>
          <div id="alertResp" style="display:none;font-size:13px;font-weight:600;color:#334155;text-align:center;margin-top:4px;text-transform:lowercase">â€”</div>
        </section>

        <!-- RR sem card, centralizado -->
        <div class="mascotWrap" aria-hidden="true">
          <img class="mascot" src="rr.png" alt="">
        </div>
      </div>

      <div>
        <!-- SITES -->
        <section class="card">
          <div class="tag">SITES OFICIAIS</div>
          <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
          <div class="row" style="margin-top:6px">
            <input id="qSites" class="input" placeholder="Digite sua pergunta .....">
            <button id="btnSites" class="btn btn-search">Pesquisar</button>
          </div>
          <div class="hint" id="sitesBusy" style="display:none">Pesquisandoâ€¦</div>
          <div id="outSites" class="out">â€”</div>
        </section>

        <!-- PROCEDIMENTOS -->
        <section class="card" style="margin-top:16px">
          <div class="tag">PROCEDIMENTOS CRION</div>
          <h2>Procedimentos</h2>
          <p class="hint">Material de Treinamento, Quiz, Alertas &gt; 30 dias e demais informaÃ§Ãµes.</p>
          <div class="row">
            <input id="qCRION" class="input" placeholder="Ex.: Onboarding, RetenÃ§Ã£o, URA, Script de CobranÃ§a, Affix">
            <button id="btnCRION" class="btn btn-search" style="min-width:112px">Pesquisar</button>
          </div>
          <div class="hint" id="crionBusy" style="display:none">Listandoâ€¦</div>
          <div id="crionStatus" class="hint" style="margin-top:6px">â€”</div>
          <ul id="crionList" style="margin:8px 0 0;padding:0;list-style:none"></ul>
        </section>
      </div>
    </div>

    <footer><span class="footnote">Â© 2025 HDSTEC â€¢ CRION</span></footer>
  </div>

  <!-- JS: apenas os handlers jÃ¡ existentes que vocÃª usa com o GAS -->
  <script>
    const $ = s => document.querySelector(s);
    const show = (el, on=true)=>{ if(!el) return; el.style.display = on? '' : 'none'; };

    // ALERTA (mesmo comportamento, sem botÃ£o Ajustar)
    async function call(endpoint, payload){
      return new Promise((resolve,reject)=>{
        const r = google.script.run.withSuccessHandler(res=>{
          if(endpoint==='chat' && typeof res==='string') resolve({ok:true, text:res});
          else resolve(res);
        }).withFailureHandler(err=>reject(err));
        try{
          switch(endpoint){
            case 'getalert': r.apiGetAlert(); break;
            case 'searchcrion': r.apiSearchCrion(payload.q); break;
            case 'fetchcrionsnippets': r.apiFetchCrionSnippets(payload.sessionId, payload.from, payload.limit); break;
            case 'chat': r.chatServer(payload.q, navigator.userAgent||''); break;
            default: reject('endpoint nÃ£o mapeado');
          }
        }catch(e){ reject(e); }
      });
    }
    $('#btnAlert').addEventListener('click', async ()=>{
      const msg=$('#alertMsg'), resp=$('#alertResp');
      show(msg,false); show(resp,false); show($('#alertBusy'),true);
      try{
        const r = await call('getalert',{});
        if(!r || r.ok===false){ msg.textContent="Falha ao consultar."; show(msg,true); return; }
        if(!r.found){ msg.textContent="Sem recado no momento."; show(msg,true); return; }
        msg.textContent = "ðŸš¨ " + String(r.mensagem||"â€”").toUpperCase(); show(msg,true);
        if(r.responsavel){ resp.textContent = String(r.responsavel||"").toLowerCase(); show(resp,true); }
      }catch(e){ msg.textContent="Erro: "+(e.message||e); show(msg,true);
      }finally{ show($('#alertBusy'),false); }
    });

    // SITES
    $('#btnSites').addEventListener('click', async ()=>{
      const q=($('#qSites').value||'').trim();
      if(!q){ $('#outSites').textContent='Digite a pergunta.'; return; }
      show($('#sitesBusy'),true); $('#outSites').textContent='â€”';
      try{
        const qRich = q + " â€” FORMATO: responda em portuguÃªs e liste as URLs oficiais no final. Substitua notas por: 'Fontes oficiais Affix, Alter, Hapvida'.";
        const r = await call('chat',{q:qRich});
        const txt = (r && r.text) ? r.text : 'â€”';
        const html = String(txt).replace(/(https?:\/\/[^\s]+)/g, m=>`<a href="${m}" target="_blank" rel="noopener">${m}</a>`);
        $('#outSites').innerHTML = html;
      }catch(e){ $('#outSites').textContent='Erro: '+(e.message||e);
      }finally{ show($('#sitesBusy'),false); }
    });

    // CRION
    $('#btnCRION').addEventListener('click', doCRION);
    async function doCRION(){
      const q=($('#qCRION').value||'').trim();
      if(!q){ $('#crionStatus').textContent='Digite um termo.'; return; }
      show($('#crionBusy'),true); $('#crionStatus').textContent='Listandoâ€¦'; $('#crionList').innerHTML="";
      try{
        const res = await call('searchcrion',{q});
        if(!res || res.ok===false){ $('#crionStatus').textContent='Erro ao buscar: '+(res&&res.message?res.message:''); return; }
        const items=res.items||[]; $('#crionStatus').textContent=`Resultados: ${items.length}`;
        const frag=document.createDocumentFragment();
        items.forEach((it,idx)=>{
          const li=document.createElement('li'); li.style.padding="10px 0"; li.style.borderTop="1px solid var(--line)";
          li.innerHTML=`<div><b>${(it.name||'').replace(/^(OCR_TMP_|TMP_SLIDES_)+/ig,'')}</b> â€¢ <a href="${it.url}" target="_blank" rel="noopener">Abrir</a></div>
                        <div class="hint">Tamanho: ${it.size? (it.size/1024/1024).toFixed(1)+' MB' : 'â€”'} â€¢ Atualizado: ${it.updated? new Date(it.updated).toLocaleString(): "â€”"}</div>`;
          frag.appendChild(li);
        });
        $('#crionList').appendChild(frag);
      }catch(e){ $('#crionStatus').textContent='Erro: '+(e.message||e);
      }finally{ show($('#crionBusy'),false); }
    }
  </script>
</body>
</html>

<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RIC AI ‚Äî CRION</title>
<style>
  :root{
    --bg1:#0e73a9; --bg2:#1b7eb3;
    --ink:#0b1220; --muted:#6b7a90; --line:#dfe8f3;
    --chip:#f3eaff; --chip-ink:#5b21b6;
    --ok1:#22c55e; --ok2:#84cc16;
    --card:#ffffff; --shadow:0 20px 50px rgba(0,0,0,.10);
  }
  *{box-sizing:border-box}
  body{margin:0;font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink)}
  .wrap{max-width:1260px;margin:0 auto;padding:18px}

  /* HEADER */
  .hero{
    background:linear-gradient(135deg,#1e7db2,#2c8ec2);
    border-radius:18px;padding:12px 16px;box-shadow:var(--shadow);
    display:flex;align-items:center;gap:14px;justify-content:space-between
  }
  .brand{display:flex;align-items:center;gap:14px}
  .logo{height:44px;display:block}
  .tools{display:flex;gap:12px}
  .tool{
    width:44px;height:44px;border-radius:14px;background:#ffffff20;border:1px solid #ffffff3d;
    display:grid;place-items:center;backdrop-filter:blur(4px);cursor:pointer;transition:.15s
  }
  .tool:hover{transform:translateY(-1px);background:#ffffff2e}
  .tool svg{width:22px;height:22px}

  /* GRID */
  .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:16px;margin-top:16px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  /* CARDS */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:var(--shadow)
  }
  .tag{display:inline-flex;align-items:center;gap:8px;background:var(--chip);color:var(--chip-ink);
       border:1px solid #e9d7ff;border-radius:999px;padding:6px 12px;font-weight:800;font-size:12px}
  h2{margin:10px 0 12px;font-size:20px;letter-spacing:.2px}
  .row{display:flex;gap:10px;align-items:center}
  .input{flex:1;border:1px solid var(--line);border-radius:10px;padding:12px 14px;background:#f9fbff}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 18px;font-weight:900;cursor:pointer}
  .btn-ok{color:#053;background:linear-gradient(135deg,var(--ok1),var(--ok2));box-shadow:0 10px 22px rgba(34,197,94,.28)}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .out{white-space:pre-wrap;min-height:160px;border:1px dashed var(--line);border-radius:12px;padding:12px;margin-top:10px;background:#fbfdff}

  /* RR.png bloco */
  .rrWrap{display:grid;place-items:center;padding:8px}
  .rr{max-width:520px;width:100%;height:auto;display:block;filter:drop-shadow(0 18px 38px rgba(86,115,189,.35))}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <header class="hero">
      <img class="logo" src="HDS.png" alt="CRION logo" id="logoCrion">
      <div class="tools">
        <!-- Post-it (SVG n√≠tido) -->
        <button class="tool" title="Post-it" id="toggleNote" aria-label="Post-it">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M7 3h7a4 4 0 0 1 4 4v6l-6 6H7a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4Z" stroke="#fff" stroke-width="2"/>
            <path d="M18 13h-3a4 4 0 0 0-4 4v3" stroke="#fff" stroke-width="2"/>
          </svg>
        </button>
        <!-- Calculadora (SVG n√≠tido) -->
        <button class="tool" title="Calculadora" id="toggleCalc" aria-label="Calculadora">
          <svg viewBox="0 0 24 24" fill="none">
            <rect x="4" y="3" width="16" height="18" rx="3" stroke="#fff" stroke-width="2"/>
            <rect x="7" y="6" width="10" height="3" rx="1" fill="#fff"/>
            <path d="M8 12h2M8 16h2M12 12h2M12 16h2M16 12h2M16 16h2" stroke="#fff" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <img class="logo" src="icon2.png" alt="HDSTEC logo" id="logoHdstec">
    </header>

    <div class="grid">
      <!-- COLUNA ESQUERDA: ALERTA + RR.png -->
      <section class="card">
        <div class="tag">ALERTAS</div>
        <h2>Controle de alerta</h2>
        <div class="row">
          <button id="btnAlert" class="btn btn-ok">PESQUISAR</button>
        </div>
        <div id="alertBox" class="out" style="min-height:120px;margin-top:10px">‚Äî</div>
      </section>

      <!-- COLUNA DIREITA: SITES -->
      <section class="card">
        <div class="tag" style="background:#e9efff;color:#1e3a8a;border-color:#d8e4ff">SITES</div>
        <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
        <div class="row" style="margin-top:6px">
          <input id="qSites" class="input" placeholder="Digite sua pergunta ....."/>
          <button id="btnSites" class="btn btn-ok">PESQUISAR</button>
        </div>
        <div id="outSites" class="out">‚Äî</div>
      </section>

      <!-- RR grande e central -->
      <section class="card rrWrap">
        <img src="rr.png" class="rr" alt="RIC ‚Äî Precisa de ajuda?"/>
      </section>

      <!-- PROCEDIMENTOS -->
      <section class="card">
        <div class="tag" style="background:#fff4e5;color:#9a3412;border-color:#ffe2bf">PROCEDIMENTOS</div>
        <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
        <div class="row" style="margin-top:6px">
          <input id="qCRION" class="input" placeholder="Digite sua pergunta ....."/>
          <button id="btnCRION" class="btn btn-ok">PESQUISAR</button>
        </div>
        <div id="crionList" class="out">‚Äî</div>
      </section>
    </div>
  </div>

<script>
/* ========== CONFIG: seu GAS publicado ==========
   Precisa estar: Implantado como vers√£o ‚Ä¢ Executar como "propriet√°rio" ‚Ä¢ Acesso "Qualquer pessoa".
*/
const APP_URL = "https://script.google.com/macros/s/AKfycbxnTEhSw1u5Ib0jCqJsURoZM30VfCpfeqKqKvYpXdKgJDUPrw8Q8hScbSzw4zVkI7u0rw/exec";

/* Helper para evitar preflight: Content-Type 'text/plain' */
async function gas(fn, payload={}){
  const url = APP_URL + "?fn=" + encodeURIComponent(fn);
  const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "text/plain" },
    body: JSON.stringify(payload)
  });
  if(!res.ok) throw new Error("HTTP "+res.status);
  return await res.json();
}
function esc(s){ return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

/* ALERTA */
document.getElementById("btnAlert").onclick = async ()=>{
  const box = document.getElementById("alertBox");
  box.textContent = "Pesquisando...";
  try{
    const r = await gas("getalert", {});
    if(!r || r.ok===false){ box.textContent = "Falha ao consultar."; return; }
    if(!r.found){ box.textContent = "Sem recado no momento."; return; }
    box.innerHTML = `<div style="font-weight:900;color:#b91c1c;font-size:22px">üö® ${esc(String(r.mensagem||"").toUpperCase())}</div>` +
                    (r.responsavel? `<div style="color:#475569;margin-top:6px">respons√°vel: ${esc(String(r.responsavel||""))}</div>` : "");
  }catch(e){
    box.innerHTML = `<b style="color:#b91c1c">Erro: Failed to fetch</b><div class="hint">Dica: confira se o Web App do GAS est√° em ‚ÄúAnyone‚Äù e ‚ÄúExecutar como: propriet√°rio‚Äù, e se o APP_URL acima √© o da vers√£o publicada (.../exec).</div>`;
  }
};

/* SITES (chatServer) */
document.getElementById("btnSites").onclick = async ()=>{
  const q = (document.getElementById("qSites").value||"").trim();
  const out = document.getElementById("outSites");
  if(!q){ out.textContent = "Digite a pergunta."; return; }
  out.textContent = "Pesquisando...";
  try{
    const r = await gas("chat",{ q });
    const txt = (r && (r.text || r.answer)) || "‚Äî";
    const html = String(txt).replace(/(https?:\/\/[^\s)]+)/g, m=>`<a href="${m}" target="_blank" rel="noopener">${m}</a>`);
    out.innerHTML = html;
  }catch(e){ out.innerHTML = `<b style="color:#b91c1c">Erro: Failed to fetch</b>`; }
};

/* CRION (lista + pr√©vias) */
document.getElementById("btnCRION").onclick = async ()=>{
  const q = (document.getElementById("qCRION").value||"").trim();
  const out = document.getElementById("crionList");
  if(!q){ out.textContent = "Digite um termo."; return; }
  out.textContent = "Listando arquivos...";
  try{
    const res = await gas("searchcrion",{ q });
    if(!res || res.ok===false){ out.textContent="Erro ao buscar."; return; }
    if(!(res.items||[]).length){ out.textContent = "Nenhum resultado."; return; }
    // render b√°sico
    out.innerHTML = (res.items||[]).slice(0,40).map((it,idx)=>(
      `<div style="padding:8px 0;border-top:1px solid #e8eef6">
         <div><b>${esc(it.name)}</b> ‚Ä¢ <a href="${it.url}" target="_blank" rel="noopener">Abrir</a></div>
         <div class="hint">${it.updated? new Date(it.updated).toLocaleString(): "‚Äî"}</div>
         <div id="snip_${idx}" class="hint">Carregando pr√©vias‚Ä¶</div>
       </div>`
    )).join("");

    // buscar pr√©vias em lotes
    let from=0;
    while(from < res.items.length){
      const r = await gas("fetchcrionsnippets",{ sessionId: res.sessionId, from, limit: 6 });
      (r.items||[]).forEach(row=>{
        const el = document.getElementById("snip_"+row.index);
        el.innerHTML = (row.snippets && row.snippets.length)
          ? row.snippets.map(s=>`<div style="color:#374151;margin:6px 0">${esc(s)}</div>`).join("")
          : "<span class='hint'>‚Äî</span>";
      });
      from = r.to;
      if(from >= 40) break; // seguran√ßa para n√£o inundar a p√°gina
    }
  }catch(e){ out.innerHTML = `<b style="color:#b91c1c">Erro: Failed to fetch</b>`; }
};

/* Logos com mesma altura (se imagens tiverem dimens√µes diferentes) */
(function equalizeLogos(){
  const a=document.getElementById('logoCrion'), b=document.getElementById('logoHdstec');
  a.style.height=b.style.height='44px';
})();
</script>
</body>
</html>

<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RIC AI — CRION</title>
<style>
  :root{
    --base-font:12px;
    --brand:#2882bb; --brand2:#2a8fcf;
    --bg:#f7f8fc; --ink:#0f172a; --muted:#667085; --line:#E7EAF3;
    --lime:#22c55e; --lime2:#a3e635; --danger:#ef4444;
    --tag:#F2E7FF; --tag-ink:#6D28D9; --tag-shadow:0 4px 10px rgba(40,130,187,.18);
    --card-shadow:0 18px 36px rgba(99,102,241,.12), 0 8px 24px rgba(40,130,187,.10);
    --violet: #6366f1;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font:var(--base-font)/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; color:var(--ink);
    background:radial-gradient(1200px 520px at -10% -10%, #eaf4ff 0, #ffffff 60%, #f7faff 100%);
  }
  .wrap{max-width:1290px;margin:0 auto;padding:16px}

  /* ====== HEADER ====== */
  .hero{
    position:relative; min-height:78px; border-radius:18px; padding:12px 16px;
    display:flex; align-items:center; justify-content:center; color:#fff;
    background:linear-gradient(135deg,var(--brand),var(--brand2));
    box-shadow:0 24px 56px rgba(40,130,187,.22);
  }
  .hero .logo{width:120px;height:auto;object-fit:contain;filter:drop-shadow(0 2px 6px #0002)}
  .left-img{
    position:absolute; left:14px; top:50%; transform:translateY(-50%);
    height:38px; object-fit:contain; filter:drop-shadow(0 2px 4px #0002);
  }
  .right-img{position:absolute;right:14px;top:50%;transform:translateY(-50%)}
  .tools{
    position:absolute; right:148px; top:50%; transform:translateY(-50%);
    display:flex; gap:10px; align-items:center;
  }
  .iconbtn{
    width:36px;height:36px;border-radius:12px;border:1px solid #ffffff40; display:grid;place-items:center;
    cursor:pointer;backdrop-filter:blur(4px); transition:.15s; box-shadow:0 6px 14px rgba(0,0,0,.15)
  }
  .iconbtn:hover{transform:translateY(-1px)}
  .icon-note{background:#ffd95e} .icon-calc{background:#60a5fa}
  .iconbtn svg{display:block}

  /* ====== GRID / CARDS ====== */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
  @media (max-width:980px){
    .grid{grid-template-columns:1fr}
    .right-img{display:none}
    .tools{right:14px}
    .left-img{left:10px;height:22px}
  }

  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px;box-shadow:var(--card-shadow)}
  .tag{display:inline-flex;align-items:center;gap:8px;background:var(--tag);color:var(--tag-ink);
       border:1px solid #eadbff;border-radius:999px;padding:6px 12px;font-weight:800;font-size:12px;box-shadow:var(--tag-shadow)}
  h2{margin:8px 0 10px;font-size:18px}
  .row{display:flex;gap:10px;align-items:center}

  .input{width:100%;border:1px solid var(--line);border-radius:10px;padding:10px 12px;background:#fbfcff}
  .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer;user-select:none}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn-search{color:#053;background:linear-gradient(135deg,var(--lime),var(--lime2));box-shadow:0 10px 22px rgba(34,197,94,.28)}
  .btn-plain{background:#f7f7fb;color:#111;border:1px solid var(--line)}
  .btn-danger{background:var(--danger);color:#fff;box-shadow:0 10px 22px rgba(239,68,68,.24)}
  .btn-reindex{padding:6px 10px;font-size:.78rem;position:relative;top:-3px}

  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .out{
    white-space:pre-wrap;min-height:90px;border:1px dashed #c9d5ea;border-radius:12px;padding:10px;margin-top:10px;
    background:#f3f6ff;color:#0f172a;box-shadow:inset 0 1px 0 #ffffffcc
  }
  .out-alert{min-height:60px;padding:12px;text-align:center}
  #alertMsg{font-size:24px;font-weight:900;color:#991b1b;margin:0 0 6px}
  #alertResp{margin:0}

  .list{margin:8px 0 0;padding:0;list-style:none}
  .item{padding:10px 0;border-top:1px solid var(--line)}
  .snip{color:#374151;font-size:13px;margin:6px 0}

  .busy{display:flex;align-items:center;gap:8px}
  .spinner{width:16px;height:16px;border-radius:50%;border:3px solid #ffffff66;border-top-color:#fff;animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .bar{position:relative;height:6px;border-radius:999px;background:#e9e9ff;overflow:hidden}
  .bar:before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,#c7b8ff,#a78bfa,#93c5fd);animation:load 1.2s infinite}
  @keyframes load{0%{left:-100%;right:100%}50%{left:0;right:0}100%{left:100%;right:-100%}}

  /* ====== SLOT LIVRE (imagem flutuando) ====== */
  .free-card{background:transparent;border:0;box-shadow:none;padding:0}
  .free-pad{padding:10px}
  /* drop-shadow roxo, igual “vibe” dos cards */
  .rr-img{
    display:block;width:100%;height:auto;object-fit:contain;pointer-events:none;
    filter:
      drop-shadow(0 18px 36px rgba(99,102,241,.18))
      drop-shadow(0 8px 24px rgba(99,102,241,.12));
  }

  footer{margin:18px 0 6px;text-align:center}
  .copyright{font-size:12px;font-weight:700;color:#2882bb;padding:10px 12px;border-radius:10px;background:rgba(40,130,187,.06);display:inline-block}
  .credit{margin-top:4px;font-size:6px;color:#cfd6e3;display:block}

  /* mini estilização da prévia */
  .preview{
    margin-top:10px;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <div class="hero">
      <img class="left-img" src="icon2.png"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/icon2.png';"
           alt="Logo esquerdo">

      <div class="tools">
        <button id="toggleNote" type="button" class="iconbtn icon-note" title="Post-it">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8 3h8a3 3 0 0 1 3 3v7l-7 7H8a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3Z" stroke="#1f2937" stroke-width="2" fill="#fde68a"/>
            <path d="M19 13h-4a3 3 0 0 0-3 3v4" stroke="#1f2937" stroke-width="2"/>
          </svg>
        </button>
        <button id="toggleCalc" type="button" class="iconbtn icon-calc" title="Calculadora">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <rect x="4" y="3" width="16" height="18" rx="2" stroke="#0b2555" stroke-width="2" fill="#dbeafe"/>
            <rect x="7" y="6" width="10" height="3" rx="1" fill="#0b2555"/>
            <path d="M8 12h2M8 16h2M12 12h2M12 16h2M16 12h2M16 16h2" stroke="#0b2555" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <img class="logo right-img" src="HDS.png"
           onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/HDS.png';"
           alt="HDS TEC">
    </div>

    <!-- Widgets (post-it e calc) omitidos por brevidade: idênticos ao seu -->

    <!-- GRID -->
    <div class="grid">
      <!-- ALERTA (igual ao seu) -->
      <section class="card">
        <div class="tag">ALERTA</div>
        <h2>Controle de alerta</h2>
        <div class="row">
          <button id="btnAlert" type="button" class="btn btn-search">Pesquisar</button>
        </div>
        <div class="hint" id="alertBusy" style="display:none">
          <div class="busy"><div class="spinner"></div><div>Pesquisando alerta...</div></div>
          <div class="bar" style="margin-top:6px"></div>
        </div>
        <div id="alertBox" class="out out-alert" style="display:none">
          <div id="alertMsg">—</div>
          <div id="alertResp" class="hint">—</div>
        </div>
      </section>

      <!-- SITES OFICIAIS (lista PDFs do repositório) -->
      <section class="card">
        <div class="tag">SITES OFICIAIS</div>
        <h2>CRION COMERCIAL (AFFIX, ALTER e CONECTA PLAN)</h2>
        <div class="row" style="margin-top:6px">
          <input id="qSites" class="input" placeholder="Digite sua pergunta .....">
          <button id="btnSites" type="button" class="btn btn-search">Pesquisar</button>
        </div>
        <div class="hint" id="sitesBusy" style="display:none">
          <div class="busy"><div class="spinner"></div><div>Pesquisando...</div></div>
          <div class="bar" style="margin-top:6px"></div>
        </div>
        <div id="outSites" class="out">—</div>
      </section>

      <!-- SLOT LIVRE → imagem PNG flutuando -->
      <section class="free-card">
        <div class="free-pad">
          <img class="rr-img" src="rr.png"
               onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/HD-TECH-hash/Ricai-crion-operacao/main/rr.png';"
               alt="Mascote RIC acenando">
        </div>
      </section>

      <!-- CRION (igual ao seu) -->
      <section class="card">
        <div class="tag">PROCEDIMENTOS CRION</div>
        <h2>Procedimentos</h2>
        <p class="hint">Material de Treinamento, Quiz, Alertas &gt; 30 dias e demais informações.</p>
        <div class="row">
          <input id="qCRION" class="input" placeholder="Ex.: Onboarding, Retenção, URA, Script de Cobrança, Affix">
          <button id="btnCRION" type="button" class="btn btn-search" style="min-width:112px">Pesquisar</button>
          <button id="btnReIdxCRION" type="button" class="btn btn-danger btn-reindex" style="min-width:112px; display:none">Reindexar</button>
        </div>
        <div class="hint" id="crionBusy" style="display:none">
          <div class="busy"><div class="spinner"></div><div>Listando procedimentos...</div></div>
          <div class="bar" style="margin-top:6px"></div>
        </div>
        <div class="out" id="crionBox">
          <div id="crionStatus" class="hint" style="margin-top:0">—</div>
          <ul id="crionList" class="list"></ul>
        </div>
      </section>
    </div>

    <footer>
      <span class="copyright">© 2025 Copyright: HDSTEC. Todos os Direitos Reservados v3.0.0 -Operacao</span>
      <span class="credit">desenvolvido por Alexandre Cavalcante</span>
    </footer>
  </div>

<script>
/* ======= CONFIG ======= */
const APP_URL = "https://script.google.com/macros/s/AKfycbxnTEhSw1u5Ib0jCqJsURoZM30VfCpfeqKqKvYpXdKgJDUPrw8Q8hScbSzw4zVkI7u0rw/exec";

/* ======= HELPERS ======= */
const $  = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const show = (el, on=true)=>{ if(!el) return; el.style.display = on? "" : "none"; };
const esc  = s => String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
function humanSize(b){ if(!b||b<=0) return "—"; const u=["B","KB","MB","GB"]; let i=0; while(b>=1024&&i<u.length-1){ b/=1024; i++; } return b.toFixed(1)+" "+u[i]; }

/* ======= GAS: ALERTA e CRION (iguais) ======= */
function call(endpoint, payload){
  const url = APP_URL + "?fn=" + encodeURIComponent(endpoint);
  return fetch(url, {
    method:"POST",
    headers:{ "Content-Type":"text/plain" },
    body: JSON.stringify(payload || {})
  }).then(r=>{ if(!r.ok) throw new Error("HTTP "+r.status); return r.json(); });
}

document.addEventListener('DOMContentLoaded', () => {
  /* ALERTA */
  $('#btnAlert')?.addEventListener('click', async ()=>{
    const box=$('#alertBox'), msg=$('#alertMsg'), resp=$('#alertResp');
    show(box,false); show($('#alertBusy'),true);
    try{
      const r = await call('getalert',{});
      if(!r || r.ok===false){ msg.textContent="Falha ao consultar."; resp.textContent=""; show(box,true); return; }
      if(!r.found){ msg.textContent="Sem recado no momento."; resp.textContent=""; show(box,true); return; }
      msg.textContent = "🚨 " + String(r.mensagem||"—").toUpperCase();
      resp.textContent = r.responsavel ? String(r.responsavel||"").toLowerCase() : "";
      show(box,true);
    }catch(e){ msg.textContent="Erro: "+e.message; resp.textContent=""; show(box,true);
    }finally{ show($('#alertBusy'),false); }
  });

  /* ========== SITES OFICIAIS: lista PDFs do repositório ========== */
  $('#btnSites')?.addEventListener('click', doSites);
  $('#qSites')?.addEventListener('keydown', e=>{ if(e.key==='Enter') doSites(); });

  async function doSites(){
    const q = ($('#qSites').value||'').trim().toLowerCase();
    show($('#sitesBusy'),true);
    $('#outSites').textContent='—';
    try{
      // carrega o manifesto gerado pelo workflow
      const resp = await fetch('data/affix/manifest.json', {cache: 'no-store'});
      if(!resp.ok) throw new Error('manifest.json não encontrado');
      const manifest = await resp.json();
      const items = Object.values(manifest.items||manifest||{}); // compatível com ambos formatos

      // normaliza
      const rows = items.map(it => ({
        name: it.saved_name || it.name || (it.url ? new URL(it.url).pathname.split('/').pop() : 'arquivo.pdf'),
        size: it.bytes || it.size || 0,
        url:  it.local_path || `data/affix/raw/${(it.saved_name||it.name||'').replace(/^\/+/,'')}`
      }));

      // filtro simples
      const filt = q ? rows.filter(r => r.name.toLowerCase().includes(q)) : rows;

      const head = `Resultados: ${filt.length}${q?` • filtro: “${esc(q)}”`:""}`;
      const out = document.createElement('div');
      out.innerHTML = `<div class="hint" style="margin-bottom:8px">${head}</div>`;
      filt.forEach((r,idx)=>{
        const box = document.createElement('div');
        box.className = 'item';
        box.innerHTML = `
          <div style="font-weight:800">${esc(r.name)}</div>
          <div class="row" style="margin-top:8px;gap:8px">
            <a class="btn btn-plain" href="${r.url}">Abrir</a>
            <button class="btn btn-plain" data-prev="${idx}">Prévia</button>
          </div>
          <div class="hint" style="margin-top:8px">Tamanho: ${humanSize(r.size)}</div>
          <div id="prev_${idx}" class="preview" style="display:none"></div>
        `;
        out.appendChild(box);
      });

      const container = document.createElement('div');
      container.appendChild(out);
      $('#outSites').innerHTML = '';
      $('#outSites').appendChild(container);

      // prévia sob demanda
      container.addEventListener('click', (ev)=>{
        const btn = ev.target.closest('button[data-prev]');
        if(!btn) return;
        const i = btn.getAttribute('data-prev');
        const pane = document.getElementById('prev_'+i);
        const url  = filt[i].url;
        if(pane.style.display==='none'){
          pane.style.display = '';
          pane.innerHTML = `
            <object data="${url}#view=FitH" type="application/pdf" width="100%" height="420">
              <div style="padding:12px">Não foi possível embutir a prévia. <a href="${url}" target="_blank" rel="noopener">Abrir PDF</a></div>
            </object>
          `;
        }else{
          pane.style.display = 'none';
          pane.innerHTML = '';
        }
      });

    }catch(e){
      $('#outSites').textContent = 'Erro: '+e.message;
    }finally{
      show($('#sitesBusy'),false);
    }
  }

  /* CRION — igual ao seu (omitido por brevidade), só manter o que já estava funcionando */
  // ... (mantenha seu bloco CRION original)

});
</script>
</body>
</html>
